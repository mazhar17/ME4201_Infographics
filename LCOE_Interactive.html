<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive LCOE Analysis Infographic</title>
    <style>
        :root {
            --bg-color: #f8fafc;
            --card-bg: #ffffff;
            --text-main: #334155;
            --text-light: #64748b;
            --primary: #2563eb;
            --border: #e2e8f0;
            
            /* Plant Colors */
            --col-coal: #475569;
            --col-gas: #d97706;
            --col-wind: #0ea5e9;
            --col-solar: #eab308;
            
            /* Component Colors for Stacked Bars */
            --comp-cap: #94a3b8; /* Capital Recovery */
            --comp-om: #cbd5e1;  /* O&M */
            --comp-fuel: #475569; /* Fuel */
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
            max-width: 800px;
        }

        h1 {
            margin: 0;
            color: var(--text-main);
            font-size: 1.8rem;
        }

        .subtitle {
            color: var(--text-light);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* Main Grid Layout */
        .container {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            max-width: 1200px;
            width: 100%;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 1px solid var(--border);
        }

        /* Left Panel: Controls */
        .controls-panel {
            background-color: #f1f5f9;
            padding: 20px;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .panel-section {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .section-title {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* Plant Selector Tabs */
        .plant-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
        }

        .tab-btn {
            flex: 1;
            padding: 8px 4px;
            font-size: 0.75rem;
            border: 1px solid var(--border);
            background: white;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            font-weight: 600;
        }

        .tab-btn.active {
            color: white;
            border-color: transparent;
        }

        .tab-coal.active { background-color: var(--col-coal); }
        .tab-gas.active { background-color: var(--col-gas); }
        .tab-wind.active { background-color: var(--col-wind); }
        .tab-solar.active { background-color: var(--col-solar); }

        /* Sliders */
        .control-group {
            margin-bottom: 15px;
        }

        .label-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            margin-bottom: 4px;
            color: var(--text-main);
        }

        .value-display {
            font-weight: bold;
            color: var(--primary);
        }

        input[type=range] {
            width: 100%;
            cursor: pointer;
            accent-color: var(--primary);
        }

        .tooltip {
            border-bottom: 1px dotted var(--text-light);
            cursor: help;
            position: relative;
        }

        .tooltip:hover::after {
            content: attr(data-tip);
            position: absolute;
            left: 0;
            bottom: 100%;
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.75rem;
            width: 200px;
            z-index: 10;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Right Panel: Visualization */
        .viz-panel {
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .chart-container {
            flex: 1;
            position: relative;
            min-height: 400px;
        }

        /* SVG Styles */
        svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }

        .bar-group { transition: all 0.3s ease; }
        .bar-rect { transition: height 0.3s ease, y 0.3s ease; }
        
        .axis-line { stroke: var(--border); stroke-width: 1; }
        .axis-text { font-size: 12px; fill: var(--text-light); }
        .bar-label { font-size: 14px; font-weight: bold; fill: var(--text-main); text-anchor: middle; }
        .bar-sublabel { font-size: 11px; fill: var(--text-light); text-anchor: middle; }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 10px;
            font-size: 0.8rem;
        }
        
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .color-box { width: 12px; height: 12px; border-radius: 2px; }

        /* Educational Content */
        .edu-section {
            margin-top: 20px;
            padding: 20px;
            background: #fff;
            border-top: 1px solid var(--border);
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .edu-card h3 { margin-top: 0; font-size: 1rem; color: var(--primary); }
        .edu-card p { font-size: 0.85rem; line-height: 1.5; color: var(--text-light); }

        /* Footer */
        footer {
            margin-top: 20px;
            font-size: 0.75rem;
            color: var(--text-light);
            text-align: center;
        }

        @media (max-width: 800px) {
            .container { grid-template-columns: 1fr; }
            .edu-section { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <header>
        <h1>Levelized Cost of Electricity (LCOE)</h1>
        <div class="subtitle">Power Plant Engineering Economic Analysis Tool</div>
    </header>

    <div class="container">
        
        <!-- CONTROLS PANEL -->
        <div class="controls-panel">
            
            <!-- Global Settings -->
            <div class="panel-section">
                <div class="section-title">
                    Global Economics
                    <span class="tooltip" data-tip="The cost of capital. A higher rate favors fuels with low upfront costs (like Gas) over capital-heavy ones (like Wind/Solar).">?</span>
                </div>
                <div class="control-group">
                    <div class="label-row">
                        <label>Discount Rate (r)</label>
                        <span class="value-display" id="val-discount">7%</span>
                    </div>
                    <input type="range" id="input-discount" min="3" max="15" step="0.5" value="7">
                </div>
                <div class="control-group">
                    <div class="label-row">
                        <label>Lifetime (n)</label>
                        <span class="value-display" id="val-life">25 yrs</span>
                    </div>
                    <input type="range" id="input-life" min="15" max="40" step="5" value="25">
                </div>
            </div>

            <!-- Plant Specific Settings -->
            <div class="panel-section">
                <div class="section-title">Plant Configuration</div>
                
                <div class="plant-tabs">
                    <button class="tab-btn tab-coal" onclick="selectPlant('coal')">Coal</button>
                    <button class="tab-btn tab-gas" onclick="selectPlant('gas')">Gas</button>
                    <button class="tab-btn tab-wind active" onclick="selectPlant('wind')">Wind</button>
                    <button class="tab-btn tab-solar" onclick="selectPlant('solar')">Solar</button>
                </div>

                <div id="plant-controls">
                    <!-- Dynamic Controls Injected Here -->
                </div>
            </div>

            <div class="edu-card" style="background:none; padding:0; border:none;">
                <p style="font-size: 0.8rem; color: #64748b;">
                    <strong>Note:</strong> Adjusting sliders changes the currently selected plant. The chart compares all four based on their current settings.
                </p>
            </div>
        </div>

        <!-- VISUALIZATION PANEL -->
        <div class="viz-panel">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h2 style="margin:0; font-size:1.2rem;">LCOE Comparison ($/MWh)</h2>
                <div class="legend">
                    <div class="legend-item"><div class="color-box" style="background:var(--comp-cap)"></div>Capital</div>
                    <div class="legend-item"><div class="color-box" style="background:var(--comp-fuel)"></div>Fuel</div>
                    <div class="legend-item"><div class="color-box" style="background:var(--comp-om)"></div>O&M</div>
                </div>
            </div>
            
            <div class="chart-container" id="chart-container">
                <!-- SVG Chart Injected Here -->
            </div>

            <!-- Educational Footer inside Viz -->
            <div class="edu-section">
                <div class="edu-card">
                    <h3>What is LCOE?</h3>
                    <p>The Levelized Cost of Electricity represents the average revenue per unit of electricity generated that would be required to recover the costs of building and operating a generating plant during an assumed financial life and duty cycle.</p>
                </div>
                <div class="edu-card">
                    <h3>Key Drivers</h3>
                    <p><strong>Capacity Factor:</strong> The % of time a plant runs at full power. Higher is better. Renewables are limited by weather.<br/>
                    <strong>Discount Rate:</strong> Represents the time value of money. High rates punish capital-intensive projects (Wind/Solar/Nuclear).</p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>Generated for Power Plant Engineering Education. Calculations based on Simplified Annualized Cost Method.</p>
    </footer>

    <script>
        // --- DATA STATE ---
        // Initial values loosely based on EIA/Lazard 2023 averages
        const plants = {
            coal: {
                name: "Coal",
                color: "#475569",
                capitalCost: 3500, // $/kW
                fuelCost: 25,      // $/MWh
                fixedOM: 40,       // $/kW-yr
                variableOM: 5,     // $/MWh
                capacityFactor: 60 // %
            },
            gas: {
                name: "Gas CC",
                color: "#d97706",
                capitalCost: 1100,
                fuelCost: 45,
                fixedOM: 15,
                variableOM: 3,
                capacityFactor: 55
            },
            wind: {
                name: "Onshore Wind",
                color: "#0ea5e9",
                capitalCost: 1600,
                fuelCost: 0,
                fixedOM: 35,
                variableOM: 0,
                capacityFactor: 40
            },
            solar: {
                name: "Solar PV",
                color: "#eab308",
                capitalCost: 1300,
                fuelCost: 0,
                fixedOM: 20,
                variableOM: 0,
                capacityFactor: 25
            }
        };

        const globalParams = {
            discountRate: 7, // %
            lifetime: 25     // years
        };

        let activePlantKey = 'wind';

        // --- DOM ELEMENTS ---
        const inputDiscount = document.getElementById('input-discount');
        const inputLife = document.getElementById('input-life');
        const valDiscount = document.getElementById('val-discount');
        const valLife = document.getElementById('val-life');
        const plantControlsDiv = document.getElementById('plant-controls');
        const chartContainer = document.getElementById('chart-container');
        const tabBtns = document.querySelectorAll('.tab-btn');

        // --- CORE FUNCTIONS ---

        // 1. Calculate LCOE
        function calculateLCOE(plant, global) {
            const r = global.discountRate / 100;
            const n = global.lifetime;
            
            // Capital Recovery Factor (CRF)
            const crf = (r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
            
            // Annual Generation per kW (MWh)
            // 8760 hours/year * Capacity Factor
            const annualGen = 8760 * (plant.capacityFactor / 100) / 1000; // Divide by 1000 to get MWh per kW capacity? No.
            // Wait, standard: 1 kW capacity * 8760 h * CF = kWh generated. 
            // LCOE units usually $/MWh.
            // Let's stick to per kW basis.
            // Annual Energy (MWh) per 1 MW Capacity = 8760 * CF.
            // Let's calculate total Annual Cost per kW capacity, then divide by MWh generated per kW.
            
            const hoursPerYear = 8760;
            const energyPerKW = (hoursPerYear * (plant.capacityFactor / 100)) / 1000; // MWh output per kW capacity
            
            // Components ($/MWh)
            
            // 1. Capital Component
            // Annualized Capital Cost ($/kW-yr) = Capital ($/kW) * CRF
            const annualizedCap = plant.capitalCost * crf;
            const lcoeCap = annualizedCap / energyPerKW;
            
            // 2. Fixed O&M Component
            // Fixed O&M is $/kW-yr
            const lcoeFixedOM = plant.fixedOM / energyPerKW;
            
            // 3. Variable Component (Fuel + Var O&M)
            // These are already typically in $/MWh or can be converted easily.
            // Our input Fuel Cost is $/MWh. Var O&M is $/MWh.
            const lcoeFuel = plant.fuelCost;
            const lcoeVarOM = plant.variableOM;
            
            const totalOM = lcoeFixedOM + lcoeVarOM;
            const total = lcoeCap + lcoeFuel + totalOM;

            return {
                total: total,
                cap: lcoeCap,
                fuel: lcoeFuel,
                om: totalOM
            };
        }

        // 2. Render Sliders for Active Plant
        function renderPlantControls() {
            const plant = plants[activePlantKey];
            
            // Update Tab Styles
            tabBtns.forEach(btn => {
                if (btn.classList.contains(`tab-${activePlantKey}`)) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            // HTML for sliders
            plantControlsDiv.innerHTML = `
                <div class="control-group">
                    <div class="label-row">
                        <label>Capital Cost ($/kW)</label>
                        <span class="value-display">${plant.capitalCost}</span>
                    </div>
                    <input type="range" data-key="capitalCost" min="500" max="6000" step="50" value="${plant.capitalCost}">
                </div>

                <div class="control-group">
                    <div class="label-row">
                        <label>Capacity Factor (%)</label>
                        <span class="value-display">${plant.capacityFactor}%</span>
                    </div>
                    <input type="range" data-key="capacityFactor" min="10" max="95" step="1" value="${plant.capacityFactor}">
                </div>

                <div class="control-group">
                    <div class="label-row">
                        <label>Fuel Cost ($/MWh)</label>
                        <span class="value-display">${plant.fuelCost}</span>
                    </div>
                    <input type="range" data-key="fuelCost" min="0" max="100" step="1" value="${plant.fuelCost}" ${plant.name.includes('Wind') || plant.name.includes('Solar') ? 'disabled style="opacity:0.5"' : ''}>
                </div>
            `;

            // Attach Event Listeners to new inputs
            const inputs = plantControlsDiv.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', (e) => {
                    const key = e.target.dataset.key;
                    const val = parseFloat(e.target.value);
                    plants[activePlantKey][key] = val;
                    
                    // Update label text
                    e.target.previousElementSibling.querySelector('.value-display').innerText = 
                        key === 'capacityFactor' ? val + '%' : val;
                        
                    updateChart();
                });
            });
        }

        // 3. Render SVG Chart
        function updateChart() {
            const width = chartContainer.offsetWidth;
            const height = 400;
            const margin = { top: 40, right: 20, bottom: 40, left: 60 };
            const chartW = width - margin.left - margin.right;
            const chartH = height - margin.top - margin.bottom;

            // Calculate Results
            const results = Object.keys(plants).map(key => {
                return { 
                    key: key, 
                    name: plants[key].name, 
                    ...calculateLCOE(plants[key], globalParams) 
                };
            });

            // Determine Scale
            const maxLCOE = Math.max(...results.map(r => r.total));
            const yMax = Math.ceil(maxLCOE * 1.1 / 10) * 10; // Add headroom
            
            const barWidth = Math.min(60, chartW / 4 - 20);
            const gap = (chartW - (barWidth * 4)) / 4;

            // Generate SVG
            let svgHTML = `<svg viewBox="0 0 ${width} ${height}">`;
            
            // Grid Lines & Y Axis
            for (let i = 0; i <= 5; i++) {
                const val = (yMax / 5) * i;
                const y = margin.top + chartH - (val / yMax * chartH);
                svgHTML += `
                    <line x1="${margin.left}" y1="${y}" x2="${width - margin.right}" class="axis-line" stroke-dasharray="${i===0 ? '' : '4 4'}" />
                    <text x="${margin.left - 10}" y="${y + 4}" text-anchor="end" class="axis-text">$${Math.round(val)}</text>
                `;
            }

            // Y Axis Label
            svgHTML += `<text x="15" y="${height/2}" transform="rotate(-90, 15, ${height/2})" text-anchor="middle" class="axis-text" font-weight="bold">LCOE ($/MWh)</text>`;

            // Bars
            results.forEach((r, i) => {
                const x = margin.left + gap/2 + i * (barWidth + gap);
                
                // Heights
                const hCap = (r.cap / yMax) * chartH;
                const hFuel = (r.fuel / yMax) * chartH;
                const hOm = (r.om / yMax) * chartH;
                
                // Y Positions (Stacking from bottom: Cap -> Fuel -> OM)
                // Actually, standard stacking order usually puts biggest at bottom. 
                // Let's do: Capital (bottom), Fuel (mid), O&M (top)
                const yCap = margin.top + chartH - hCap;
                const yFuel = yCap - hFuel;
                const yOm = yFuel - hOm;

                // Capital Bar
                svgHTML += `<rect class="bar-rect" x="${x}" y="${yCap}" width="${barWidth}" height="${hCap}" fill="var(--comp-cap)" />`;
                
                // Fuel Bar
                if (hFuel > 0) {
                    svgHTML += `<rect class="bar-rect" x="${x}" y="${yFuel}" width="${barWidth}" height="${hFuel}" fill="var(--comp-fuel)" />`;
                }
                
                // O&M Bar
                svgHTML += `<rect class="bar-rect" x="${x}" y="${yOm}" width="${barWidth}" height="${hOm}" fill="var(--comp-om)" />`;

                // Total Label
                svgHTML += `<text class="bar-label" x="${x + barWidth/2}" y="${yOm - 10}">$${Math.round(r.total)}</text>`;
                
                // X Axis Label
                svgHTML += `<text class="bar-label" x="${x + barWidth/2}" y="${height - 15}">${r.name}</text>`;
                
                // Plant Type Indicator Line
                svgHTML += `<rect x="${x}" y="${height-5}" width="${barWidth}" height="5" fill="${plants[r.key].color}" rx="2" />`;
            });

            svgHTML += `</svg>`;
            chartContainer.innerHTML = svgHTML;
        }

        // 4. Global Event Listeners
        function setupGlobalListeners() {
            inputDiscount.addEventListener('input', (e) => {
                globalParams.discountRate = parseFloat(e.target.value);
                valDiscount.innerText = globalParams.discountRate + '%';
                updateChart();
            });

            inputLife.addEventListener('input', (e) => {
                globalParams.lifetime = parseFloat(e.target.value);
                valLife.innerText = globalParams.lifetime + ' yrs';
                updateChart();
            });
        }

        // 5. Switching Plants
        window.selectPlant = function(key) {
            activePlantKey = key;
            renderPlantControls();
        };

        // --- INIT ---
        setupGlobalListeners();
        renderPlantControls();
        updateChart();

        // Handle Resize
        window.addEventListener('resize', updateChart);

    </script>
</body>
</html>