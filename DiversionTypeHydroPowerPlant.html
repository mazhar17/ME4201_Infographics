<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diversion (Run-of-River) Hydro Plant - Interactive</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Custom Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    keyframes: {
                        dash: {
                            '0%': { strokeDashoffset: '100' },
                            '100%': { strokeDashoffset: '0' }
                        },
                        flow: {
                            '0%': { transform: 'translateX(0)' },
                            '100%': { transform: 'translateX(20px)' }
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        // --- Imports & Setup ---
        const { useState, useEffect } = React;

        // --- Inline Icons (Lucide replacement) ---
        const IconWrapper = ({ children, size = 20, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Info = (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></IconWrapper>;
        const Play = (p) => <IconWrapper {...p}><polygon points="5 3 19 12 5 21 5 3"/></IconWrapper>;
        const RotateCw = (p) => <IconWrapper {...p}><path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></IconWrapper>;
        const HelpCircle = (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></IconWrapper>;
        const Activity = (p) => <IconWrapper {...p}><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></IconWrapper>;
        const Settings = (p) => <IconWrapper {...p}><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></IconWrapper>;
        const Waves = (p) => <IconWrapper {...p}><path d="M2 6c.6.5 1.2 1 2.5 1C7 7 7 5 9.5 5c2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 12c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/><path d="M2 18c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 2.6 0 2.4 2 5 2 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1"/></IconWrapper>;

        // --- Plant Data ---

        const COMPONENTS = [
            {
                id: 'weir',
                name: 'Diversion Weir',
                role: 'Water Diversion',
                description: 'A low dam built across the river to raise the water level slightly and divert flow into the intake. Unlike impoundment dams, it does not store significant water.',
                type: 'hydraulic',
                specs: 'Low Head Barrier'
            },
            {
                id: 'intake',
                name: 'Intake & Trash Rack',
                role: 'Flow Entry',
                description: 'Controls water entry into the canal system. Coarse trash racks prevent logs and large debris from entering the headrace.',
                type: 'hydraulic',
                specs: 'Flow Regulation'
            },
            {
                id: 'desilting',
                name: 'Desilting Basin',
                role: 'Sediment Removal',
                description: 'A widened channel section that slows water velocity, allowing abrasive silt and sand to settle before reaching the turbine. Critical for run-of-river plants.',
                type: 'hydraulic',
                specs: 'Velocity Reduction'
            },
            {
                id: 'headrace',
                name: 'Headrace Channel',
                role: 'Conveyance',
                description: 'A long open channel or low-pressure tunnel that transports water from the intake to the forebay with minimal elevation loss.',
                type: 'hydraulic',
                specs: 'Open Channel / Tunnel'
            },
            {
                id: 'forebay',
                name: 'Forebay Tank',
                role: 'Surge Storage',
                description: 'A regulating tank at the end of the headrace. It provides a buffer of water to handle immediate load changes and houses the penstock intake.',
                type: 'potential',
                specs: 'Surge Protection'
            },
            {
                id: 'penstock',
                name: 'Penstock',
                role: 'Pressure Conduit',
                description: 'Steep pipe connecting the forebay to the turbine. It converts the potential energy of the water elevation into kinetic energy.',
                type: 'kinetic',
                specs: 'High Pressure Pipe'
            },
            {
                id: 'powerhouse',
                name: 'Powerhouse',
                role: 'Energy Conversion',
                description: 'Houses the turbine and generator. In run-of-river schemes, these are often Pelton or Francis turbines depending on the head.',
                type: 'mechanical',
                specs: 'Turbine + Generator'
            },
            {
                id: 'tailrace',
                name: 'Tailrace',
                role: 'Discharge',
                description: 'Channel returning the water to the river downstream. The elevation difference between the Forebay and Tailrace defines the gross head.',
                type: 'hydraulic',
                specs: 'River Return'
            },
            {
                id: 'transmission',
                name: 'Transmission',
                role: 'Grid Connection',
                description: 'Step-up transformers and lines delivering power to the grid.',
                type: 'electrical',
                specs: 'HV AC Output'
            }
        ];

        const FLOW_STAGES = [
            { id: 'source', label: 'River Source', color: 'bg-blue-400', activeIds: ['weir', 'intake'] },
            { id: 'conveyance', label: 'Conveyance', color: 'bg-cyan-500', activeIds: ['desilting', 'headrace', 'forebay'] },
            { id: 'conversion', label: 'Energy Conversion', color: 'bg-orange-500', activeIds: ['penstock', 'powerhouse'] },
            { id: 'output', label: 'Electrical Output', color: 'bg-yellow-500', activeIds: ['transmission', 'tailrace'] }
        ];

        // --- Main Component ---

        function DiversionPlantApp() {
            const [activeId, setActiveId] = useState(null);
            const [flowMode, setFlowMode] = useState(false);
            const [flowStep, setFlowStep] = useState(0);
            const [quizMode, setQuizMode] = useState(false);
            const [quizTarget, setQuizTarget] = useState(null);
            const [quizScore, setQuizScore] = useState({ correct: 0, attempts: 0 });

            useEffect(() => {
                let interval;
                if (flowMode) {
                    interval = setInterval(() => {
                        setFlowStep((prev) => (prev + 1) % 5);
                    }, 2500);
                } else {
                    setFlowStep(0);
                }
                return () => clearInterval(interval);
            }, [flowMode]);

            const startQuiz = () => {
                setQuizMode(true);
                setFlowMode(false);
                setActiveId(null);
                setQuizScore({ correct: 0, attempts: 0 });
                nextQuizQuestion();
            };

            const nextQuizQuestion = () => {
                const randomComp = COMPONENTS[Math.floor(Math.random() * COMPONENTS.length)];
                setQuizTarget(randomComp);
            };

            const handleComponentClick = (id) => {
                if (quizMode) {
                    const isCorrect = id === quizTarget?.id;
                    setQuizScore(prev => ({ 
                        correct: prev.correct + (isCorrect ? 1 : 0), 
                        attempts: prev.attempts + 1 
                    }));
                    if (isCorrect) {
                        setTimeout(nextQuizQuestion, 600);
                    }
                } else {
                    setActiveId(id === activeId ? null : id);
                }
            };

            const getFill = (id, baseColor) => {
                if (flowMode && flowStep > 0) {
                    const currentStage = FLOW_STAGES[flowStep - 1];
                    if (currentStage?.activeIds.includes(id)) return '#fbbf24';
                }
                if (activeId === id) return '#fbbf24';
                if (quizMode && id === quizTarget?.id && quizScore.attempts > 0) return '#fbbf24';
                return baseColor;
            };

            const activeComponent = COMPONENTS.find(c => c.id === activeId);

            return (
                <div className="w-full min-h-screen bg-slate-50 text-slate-900 font-sans flex flex-col items-center p-4 md:p-8">
                    
                    {/* Header */}
                    <div className="w-full max-w-7xl mb-8 flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
                        <div>
                            <div className="flex items-center gap-3 mb-2">
                                <span className="bg-blue-100 text-blue-800 text-sm font-bold px-3 py-1 rounded uppercase tracking-wider">Run-of-River</span>
                                <span className="bg-slate-200 text-slate-600 text-sm font-bold px-3 py-1 rounded uppercase tracking-wider">ME Undergrad</span>
                            </div>
                            <h1 className="text-4xl md:text-5xl font-bold text-slate-900 tracking-tight">Diversion Hydroelectric Plant</h1>
                            <p className="text-slate-600 text-lg mt-2">Interactive analysis of headrace, forebay, and penstock dynamics.</p>
                        </div>
                        
                        <div className="flex gap-4">
                            <button onClick={() => { setFlowMode(!flowMode); setQuizMode(false); }} className={`flex items-center gap-2 px-6 py-3 rounded-lg text-base font-bold transition-all shadow-sm ${flowMode ? 'bg-blue-600 text-white ring-2 ring-blue-300' : 'bg-white border border-slate-300 text-slate-700 hover:bg-slate-50'}`}>
                                {flowMode ? <RotateCw className="animate-spin" size={20}/> : <Play size={20}/>}
                                {flowMode ? 'Simulating...' : 'Simulate Flow'}
                            </button>
                            <button onClick={quizMode ? () => setQuizMode(false) : startQuiz} className={`flex items-center gap-2 px-6 py-3 rounded-lg text-base font-bold transition-all shadow-sm ${quizMode ? 'bg-purple-600 text-white ring-2 ring-purple-300' : 'bg-white border border-slate-300 text-slate-700 hover:bg-slate-50'}`}>
                                <HelpCircle size={20}/> {quizMode ? 'Exit Quiz' : 'Start Quiz'}
                            </button>
                        </div>
                    </div>

                    {/* Main Layout */}
                    <div className="flex flex-col lg:flex-row gap-8 w-full max-w-7xl h-auto lg:h-[700px]">
                        
                        {/* Diagram Canvas */}
                        <div className="flex-1 bg-white rounded-xl shadow-md border border-slate-200 relative overflow-hidden group min-h-[500px]">
                            
                            <svg viewBox="0 0 800 600" className="w-full h-full select-none cursor-pointer">
                                <defs>
                                    <pattern id="waterPattern" patternUnits="userSpaceOnUse" width="40" height="40">
                                        <path d="M0 20 Q10 10 20 20 T40 20" fill="none" stroke="#60a5fa" strokeWidth="1" opacity="0.4"/>
                                    </pattern>
                                    <linearGradient id="terrainGrad" x1="0" y1="0" x2="0" y2="1">
                                        <stop offset="0%" stopColor="#e2e8f0"/>
                                        <stop offset="100%" stopColor="#cbd5e1"/>
                                    </linearGradient>
                                    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
                                      <feDropShadow dx="2" dy="2" stdDeviation="2" floodOpacity="0.1"/>
                                    </filter>
                                </defs>

                                {/* Background / Sky */}
                                <rect width="800" height="600" fill="#f8fafc" />

                                {/* Terrain Profile - COMPACTED for better view */}
                                <path d="M0,150 L150,150 L250,180 L400,180 L550,200 L600,200 L700,500 L750,500 L800,500 L800,600 L0,600 Z" fill="url(#terrainGrad)" />

                                {/* --- RIVER SOURCE (LEFT) --- */}
                                <g>
                                    <path d="M0,160 L100,160 L100,180 L0,180 Z" fill="#93c5fd" />
                                    <text x="50" y="140" className="text-sm font-bold fill-slate-500">RIVER</text>
                                </g>

                                {/* --- COMPONENT: WEIR --- */}
                                <g onClick={() => handleComponentClick('weir')} className="hover:opacity-80 transition-opacity">
                                    <path d="M100,150 L120,150 L130,180 L90,180 Z" fill={getFill('weir', '#64748b')} stroke="#475569" strokeWidth="2" />
                                </g>

                                {/* --- COMPONENT: INTAKE --- */}
                                <g onClick={() => handleComponentClick('intake')} className="hover:opacity-80">
                                    <rect x="130" y="140" width="20" height="40" fill={getFill('intake', '#475569')} />
                                    <line x1="130" y1="140" x2="130" y2="180" stroke="#1e293b" strokeDasharray="2 2" />
                                </g>

                                {/* --- COMPONENT: DESILTING BASIN --- */}
                                <g onClick={() => handleComponentClick('desilting')} className="hover:opacity-80">
                                    {/* Widened section */}
                                    <path d="M150,160 L250,160 L250,190 L150,190 Z" fill="#bfdbfe" />
                                    <rect x="150" y="160" width="100" height="30" fill="url(#waterPattern)" />
                                    <rect x="150" y="190" width="100" height="5" fill={getFill('desilting', '#94a3b8')} /> {/* Sediment trap */}
                                    <text x="200" y="215" textAnchor="middle" fontSize="12" className="fill-slate-600 font-bold">DESILTING</text>
                                </g>

                                {/* --- COMPONENT: HEADRACE CHANNEL (SHORTENED) --- */}
                                <g onClick={() => handleComponentClick('headrace')} className="hover:opacity-80">
                                    <rect x="250" y="165" width="300" height="15" fill={getFill('headrace', '#bfdbfe')} />
                                    <line x1="250" y1="180" x2="550" y2="180" stroke="#cbd5e1" strokeWidth="2" />
                                    {/* Flow Arrows */}
                                    {(flowMode && flowStep >= 2) && (
                                        <g>
                                            <circle cx="350" cy="172" r="3" fill="#2563eb" className="animate-[flow_1s_linear_infinite]" />
                                            <circle cx="450" cy="172" r="3" fill="#2563eb" className="animate-[flow_1s_linear_infinite]" />
                                        </g>
                                    )}
                                </g>

                                {/* --- COMPONENT: FOREBAY (SHIFTED LEFT) --- */}
                                <g onClick={() => handleComponentClick('forebay')} className="hover:opacity-80">
                                    <rect x="550" y="150" width="60" height="60" fill={getFill('forebay', '#93c5fd')} stroke="#3b82f6" strokeWidth="2" />
                                    <text x="580" y="135" textAnchor="middle" fontSize="12" className="fill-slate-700 font-bold">FOREBAY</text>
                                </g>

                                {/* --- COMPONENT: PENSTOCK (SHIFTED LEFT) --- */}
                                <g onClick={() => handleComponentClick('penstock')} className="hover:opacity-80">
                                    <path d="M600,200 L670,480" stroke={getFill('penstock', '#334155')} strokeWidth="12" fill="none" />
                                    {(flowMode && flowStep >= 3) && (
                                        <circle r="5" fill="#fbbf24">
                                            <animateMotion path="M600,200 L670,480" dur="0.8s" repeatCount="indefinite" />
                                        </circle>
                                    )}
                                </g>

                                {/* --- COMPONENT: POWERHOUSE (SHIFTED LEFT) --- */}
                                <g onClick={() => handleComponentClick('powerhouse')} className="hover:opacity-80">
                                    <rect x="630" y="450" width="100" height="80" fill={getFill('powerhouse', '#cbd5e1')} stroke="#475569" strokeWidth="2" />
                                    <path d="M630,450 L730,450 L680,420 Z" fill="#94a3b8" /> {/* Roof */}
                                    {/* Turbine Icon Inside */}
                                    <circle cx="680" cy="490" r="15" fill="#e2e8f0" stroke="#475569" strokeWidth="2" />
                                    <path d="M680 475 L680 505 M665 490 L695 490" stroke="#475569" strokeWidth="2" className={(flowMode && flowStep >= 3) ? "origin-[680px_490px] animate-spin" : ""} />
                                </g>

                                {/* --- COMPONENT: TAILRACE (SHIFTED LEFT) --- */}
                                <g onClick={() => handleComponentClick('tailrace')} className="hover:opacity-80">
                                    <path d="M680,530 L680,550 Q680,560 700,560 L800,560" fill="none" stroke={getFill('tailrace', '#bfdbfe')} strokeWidth="10" />
                                    <text x="720" y="585" fontSize="12" className="fill-blue-800 font-bold">TAILRACE</text>
                                </g>

                                {/* --- COMPONENT: TRANSMISSION (SHIFTED LEFT) --- */}
                                <g onClick={() => handleComponentClick('transmission')} className="hover:opacity-80">
                                    <line x1="680" y1="450" x2="680" y2="400" stroke="#1e293b" strokeWidth="2" />
                                    <polyline points="680,400 710,380 750,380" fill="none" stroke={getFill('transmission', '#f59e0b')} strokeWidth="2" />
                                    {(flowMode && flowStep >= 4) && (
                                        <circle r="4" fill="#fbbf24">
                                            <animateMotion path="M680,400 L710,380 L750,380" dur="0.5s" repeatCount="indefinite" />
                                        </circle>
                                    )}
                                </g>

                                {/* Labels & Quiz Overlay (CENTERED) */}
                                {quizMode && quizTarget && (
                                    <g>
                                        <rect x="150" y="40" width="500" height="100" rx="12" fill="white" stroke="#a855f7" strokeWidth="3" filter="url(#shadow)" />
                                        <text x="400" y="80" textAnchor="middle" className="text-lg fill-slate-400 font-bold uppercase tracking-widest">Find Component</text>
                                        <text x="400" y="115" textAnchor="middle" className="text-4xl fill-purple-700 font-black">{quizTarget.name}</text>
                                    </g>
                                )}

                            </svg>

                            {/* Legend Overlay */}
                            <div className="absolute bottom-6 left-6 bg-white/95 p-5 rounded-lg shadow-sm border border-slate-200 backdrop-blur-sm pointer-events-none">
                                <div className="text-xs font-bold uppercase text-slate-500 mb-3">Flow Cycle</div>
                                <div className="flex flex-col gap-2">
                                    {FLOW_STAGES.map((stage, idx) => (
                                        <div key={stage.id} className={`flex items-center gap-3 transition-all ${flowMode && flowStep === idx + 1 ? 'opacity-100 scale-105' : 'opacity-40'}`}>
                                            <div className={`w-3 h-3 rounded-full ${stage.color}`}></div>
                                            <span className="text-sm font-bold text-slate-800">{stage.label}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </div>

                        {/* Info Panel */}
                        <div className="w-full lg:w-96 flex flex-col gap-6">
                            <div className={`flex-1 bg-white border border-slate-200 p-8 rounded-xl shadow-md transition-all duration-300 ${activeComponent ? 'opacity-100 translate-x-0' : 'opacity-50 translate-x-4'}`}>
                                {activeComponent ? (
                                    <>
                                        <div className="flex items-center justify-between mb-6 border-b border-slate-100 pb-4">
                                            <h2 className="text-2xl font-bold text-slate-800 leading-tight">{activeComponent.name}</h2>
                                            <span className={`text-xs font-bold px-2 py-1 rounded uppercase tracking-wide ${
                                                activeComponent.type === 'electrical' ? 'bg-yellow-100 text-yellow-700' :
                                                activeComponent.type === 'mechanical' ? 'bg-orange-100 text-orange-700' :
                                                'bg-blue-100 text-blue-700'
                                            }`}>
                                                {activeComponent.type}
                                            </span>
                                        </div>
                                        <div className="space-y-8">
                                            <div>
                                                <div className="flex items-center gap-2 text-sm font-bold text-slate-400 uppercase mb-2">
                                                    <Info size={18}/> Function
                                                </div>
                                                <p className="text-base text-slate-700 leading-relaxed">{activeComponent.description}</p>
                                            </div>
                                            <div className="bg-slate-50 p-5 rounded-lg border border-slate-100">
                                                <div className="flex items-center gap-2 mb-2 text-sm font-bold text-slate-800">
                                                    <Settings size={16}/> Engineering Role
                                                </div>
                                                <div className="text-sm text-slate-600 font-medium">{activeComponent.role}</div>
                                                <div className="mt-4 flex items-center gap-2 mb-2 text-sm font-bold text-slate-800">
                                                    <Activity size={16}/> Key Spec
                                                </div>
                                                <div className="text-sm text-slate-600 font-mono bg-white p-2 rounded border border-slate-200 inline-block">
                                                    {activeComponent.specs}
                                                </div>
                                            </div>
                                        </div>
                                    </>
                                ) : (
                                    <div className="h-full flex flex-col items-center justify-center text-center text-slate-300">
                                        <Waves size={64} className="mb-6 text-blue-200 opacity-50"/>
                                        <p className="text-lg font-bold text-slate-400">Select a component<br/>to view ME specifications.</p>
                                    </div>
                                )}
                            </div>
                        </div>

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<DiversionPlantApp />);
    </script>
</body>
</html>